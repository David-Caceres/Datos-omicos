---
title: "PEC1_Análisis de datos ómicos"
author: "David Cáceres"
date: "24/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}

# Librerías necesarias


if (!require(BiocManager)) install.packages("BiocManager")
library(Biobase)
library(oligo)
library(arrayQualityMetrics)
library(ggfortify)
library(genefilter)
library(affy)
library(limma)
library(dplyr)
library(xtable)
library(gplots)
library(ggplot2)
library(AnnotationDbi)
library(ReactomePA)



# Drectorio de trabajo
dir <- getwd()

datadir <- file.path(dir,"Datos")
# Result directory
resultsdir <- file.path(dir, "Resultados")


# Selección aleatoria de las muestras

celFiles<- list.celfiles(datadir)[c(sample(1:11, 5), sample(12:29, 5), sample(30:47, 5))]

# Targets

targets <- data.frame(fileName = celFiles,
                      Groups = c(rep("Sintomaticos", 5), rep("Asintomaticos", 5),
                                 rep("Control", 5)),
                      ShortName = c(paste(rep("S", 5), seq(1:5), sep = ""),
                                    paste(rep("A", 5), seq(1:5), sep = ""),
                                    paste(rep("C", 5), seq(1:5), sep = "")))

write.csv(targets, file.path(datadir, "targets.csv"), row.names = FALSE)




# ExpressionSet


targets <- read.AnnotatedDataFrame(file.path(datadir, "targets.csv"),
header = TRUE, row.names = 1, sep = ",")
rawdata <- read.celfiles(file.path(datadir, celFiles), phenoData = targets)


# Numeros, nombres y número de muestras

group <- pData(rawdata)$X.Groups

nsamples <- nrow(pData(rawdata))

lsamples <- paste(rownames(pData(rawdata)))

rownames(pData(rawdata)) <- targets@data$X.ShortName
colnames(rawdata) <- rownames(pData(rawdata))

sampleNames <- as.character(targets$ShortName)


# Exploración de los datos


colores <- c(rep("lightskyblue1", 5), rep("deepskyblue3", 5), rep("olivedrab", 5))
boxplot(rawdata, cex.axis=0.5, las=2,  which="all", col = colores, main = "Distribution de intensidades por grupos en datos crudos")


# Gráfico PCA

autoplot(prcomp(t(exprs(rawdata))),
         colour = colores,
         main = "PCA de los datos crudos",
         label = T, shape = FALSE)

# Control de calidad

arrayQualityMetrics(rawdata, outdir = "Informe_de_calidad", force=TRUE)

# Normalización

require(affy)
esetdata <- rma(rawdata)
write.exprs(esetdata, file.path(resultsdir, "Normdata.txt"))

```

### 1. Resumen


### 2. Objetivos

Partiendo de la base de que el data set está dividido en 3 tipos de muestras: sintomáticos, asintomáticos, y controles sanos. Obtenidas a partir de pacientes de COVID-19. Realizaremos un análisis de microarray cruzado entre los 3 grupos, de este modo haremos 3 comparaciones.

a. Expresión diferencial entre casos sintomáticos y asintomáticos

b. Expresión diferencial entre casos sintomáticos y controles sanos

c. Expresión diferencial entre casos asintomáticos y controles sanos

Para ello,nos basaremos en las muestras propuestas en la entrada GSE177477 de GEO, que pertenecen a individuos procedentes de Pakistan, y que fueron analizadas usando "Clariom S RNA Microarray, Affymetrix Inc."


### 3 Material y métodos


#### 3.1 Herramientas informáticas

El presente análisis se realizó usando la versión 4.1.3 (2022-03-10) de R. Tomando como base la librería bioconductor junto con otras accesorias presentes en el código que aparece en el anexo.




#### 3.2 Objeto del estudio

El estudio del cual se deriva el dataset (Masood et al. 2021), concluye que en los pacientes asintomáticos, el interferon tipo I relacionado con la respuesta inmune a las infecciones víricas, se encuentra elevado, o regulado de una forma que produce su elevación en determinados sujetos. Esto sugiere un efecto protector respecto a los sujetos infectados que desarrollaron síntomas leves y graves. 

Los pacientes asintomáticos también mostraron una sobre expresión de genes relacionados con la respuesta humoral y una infra expresión de otros tipos de genes. El principal hayazgo, es de la sobre expresión en asitomáticos de genes relacionados con la respuesta del interferón tipo I (SOCS3, IRF2BP2, IRF2BPL), y la infra expresión del grupo de genes ((SOCS3, IRF2BP2, IRF2BPL) en comparación con los enfermos leves y graves).

Todo esto nos lleva a pensar que la respuesta inicial a la COVID-19 puede estar mediada por genes relacionados al interferón tipo I.

El estudio diferencia entre 3 grupos: asintomáticos (A), sintomáticos (S), y controles (C). Con muestras de 47 sujetos repartidas en los 3 grupos (11(A), 18(S), 18(C)).


#### 3.3 Selección de los datos

Seleccionamos las muestras de forma aleatoria a partir de los 3 grupos citados, para ello, fijamos la "seed" en 1314 y tomamos 15 muestras(3 de cada grupo).

Las muestras seleccionadas son:

(A). "GSM5374844_S6.CEL"  "GSM5374843_S5.CEL"  "GSM5374849_S11.CEL" "GSM5374847_S9.CEL"  "GSM5374841_S3.CEL"

(S). "GSM5374864_S26.CEL" "GSM5374863_S25.CEL" "GSM5374865_S27.CEL" "GSM5374854_S16.CEL" "GSM5374852_S14.CEL"

(C). "GSM5374885_S47.CEL" "GSM5374884_S46.CEL" "GSM5374881_S43.CEL" "GSM5374869_S31.CEL" "GSM5374871_S33.CEL"


También creamos un archivo csv que contiene los identificadores de cada muestra y el grupo al que pertenecen. Esto nos servirá para crear un Expressionset.


#### 3.4 Exploración de los datos y control de calidad

Haremos una exploración inicial de los datos a través de su visualización en gráficos de caja, de dispersión y un cluster jerárquico, junto con un análisis de de componentes principales (PCA). Estamos ante un microarray de un array de un solo color, así que los datos proceden del análisis de las intensidades de señal de cada microarray.

Usaremos rawdata, que contiene los datos de las muestras seleccionadas para la exploración.


Comenzamos exponiendo los datos de la distribución de intensidades del microarray en los datos crudos (rawdata). Observamos que la distribución inicial tienen cierta uniformidad, pero que algunas muestras se desvían más de la media, este efecto es más acusado en el grupo de los asintomáticos.

```{r echo=FALSE}
colores <- c(rep("lightskyblue1", 5), rep("deepskyblue3", 5), rep("olivedrab", 5))
boxplot(rawdata, col = colores, xlab="Sintomaticos - Asintomaticos - Control", main = "Distribution de intensidades en datos crudos")
```

El gŕafico de componentes principales nos muestra cierto agrupamiento en los grupos sintomáticos, y asintomáticos, con bastante dispersión entre el grupo control. Las muestras s29, s47, y s44 están entre las causantes de la mayor parte de la varianza. 

```{r echo=FALSE}
autoplot(prcomp(t(exprs(rawdata))),
         colour = colores,
         main = "PCA de los datos crudos",
         label = T, shape = FALSE)
```


Cuando planteamos el dendrograma vemos que esa dispersión de las muestras citadas se ve reflejada en un agrupamientno a la izquierda. Las muestras s47, s29 y s44 aparecen emparentadas. Las demás se agrupan entre ellas sin un patrón claro.


#### Normalización


